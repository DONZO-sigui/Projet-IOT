<% // Déterminer la page active const currentPath=typeof locals.currentPath !=='undefined' ? locals.currentPath : '' ;
    %>

    <!-- Bouton toggle sidebar (mobile) -->
    <button class="sidebar-toggle" id="sidebarToggle">
        <i class="bi bi-list"></i>
    </button>

    <!-- Sidebar Admin -->
    <aside class="admin-sidebar" id="adminSidebar">
        <div class="sidebar-header">
            <h5><i class="bi bi-gear-fill me-2"></i>Administration</h5>
            <small class="text-white-50">Système IoT Pêche</small>
            <div class="mt-2 badge bg-light text-dark bg-opacity-25 w-100">
                <%= locals.userRole ? locals.userRole.toUpperCase() : 'INVITÉ' %>
            </div>
        </div>

        <nav class="sidebar-menu">
            <!-- Dashboard -->
            <div class="sidebar-section-title">
                <i class="bi bi-speedometer2 me-1"></i>
                TABLEAU DE BORD
            </div>
            <a href="/admin/dashboard"
                class="sidebar-menu-item <%= currentPath === '/admin/dashboard' ? 'active' : '' %>"
                title="Mon tableau de bord personnel">
                <i class="bi bi-grid-fill"></i>
                <span>
                    <%= locals.userRole==='pecheur' ? 'Mon Espace' : "Vue d'ensemble" %>
                </span>
            </a>
            <a href="/admin/profil" class="sidebar-menu-item <%= currentPath === '/admin/profil' ? 'active' : '' %>"
                title="Gérer mon profil">
                <i class="bi bi-person-circle"></i>
                <span>Mon Profil</span>
            </a>

            <% if (['admin', 'technicien' , 'observateur' ].includes(locals.userRole)) { %>
                <!-- Surveillance en temps réel (Admin/Technicien/Observateur) -->
                <div class="sidebar-section-title">
                    <i class="bi bi-broadcast me-1"></i>
                    SURVEILLANCE EN TEMPS RÉEL
                </div>
                <a href="/admin/ia-qualite"
                    class="sidebar-menu-item <%= currentPath === '/admin/ia-qualite' ? 'active' : '' %>"
                    title="Surveillance de la qualité de l'eau">
                    <i class="bi bi-droplet-fill"></i>
                    <span>Qualité de l'Eau</span>
                </a>
                <a href="/admin/dispositifs"
                    class="sidebar-menu-item <%= currentPath === '/admin/dispositifs' ? 'active' : '' %>"
                    title="Gestion des dispositifs IoT">
                    <i class="bi bi-cpu-fill"></i>
                    <span>Dispositifs IoT</span>
                </a>
                <% } %>

                    <a href="/admin/gps-tracking"
                        class="sidebar-menu-item <%= currentPath === '/admin/gps-tracking' ? 'active' : '' %>"
                        title="Suivi GPS des bateaux">
                        <i class="bi bi-geo-alt-fill"></i>
                        <span>Suivi GPS</span>
                        <% if (typeof locals.activeBoatsCount !=='undefined' && locals.activeBoatsCount> 0) { %>
                            <span class="sidebar-badge" title="<%= locals.activeBoatsCount %> bateau(x) actif(s)">
                                <%= locals.activeBoatsCount %>
                            </span>
                            <% } %>
                    </a>

                    <% if (['admin', 'pecheur' ].includes(locals.userRole)) { %>

                        <a href="/admin/alertes"
                            class="sidebar-menu-item <%= currentPath === '/admin/alertes' ? 'active' : '' %>"
                            title="Alertes actives du système">
                            <i class="bi bi-bell-fill"></i>
                            <span>Alertes Actives</span>
                            <% if (typeof locals.alertsCount !=='undefined' && locals.alertsCount> 0) { %>
                                <span class="sidebar-badge sidebar-badge-danger"
                                    title="<%= locals.alertsCount %> alerte(s)">
                                    <%= locals.alertsCount %>
                                </span>
                                <% } %>
                        </a>
                        <% } %>

                            <!-- Gestion des ressources -->
                            <div class="sidebar-section-title">
                                <i class="bi bi-layers-fill me-1"></i>
                                GESTION DES RESSOURCES
                            </div>
                            <a href="/admin/zones"
                                class="sidebar-menu-item <%= currentPath === '/admin/zones' ? 'active' : '' %>"
                                title="Gestion des zones de pêche">
                                <i class="bi bi-map-fill"></i>
                                <span>Zones de Pêche</span>
                            </a>
                            <% if (locals.userRole==='admin' ) { %>
                                <!-- Ancienne place, section supprimée -->
                                <% } %>

                                    <!-- Administration (Admin Only) -->
                                    <% if (locals.userRole==='admin' ) { %>
                                        <div class="sidebar-section-title">
                                            <i class="bi bi-shield-fill-check me-1"></i>
                                            ADMINISTRATION
                                        </div>
                                        <a href="/admin/utilisateurs"
                                            class="sidebar-menu-item <%= currentPath === '/admin/utilisateurs' ? 'active' : '' %>"
                                            title="Gestion des utilisateurs">
                                            <i class="bi bi-people-fill"></i>
                                            <span>Utilisateurs</span>
                                        </a>
                                        <a href="/admin/parametres"
                                            class="sidebar-menu-item <%= currentPath === '/admin/parametres' ? 'active' : '' %>"
                                            title="Paramètres du système">
                                            <i class="bi bi-gear-fill"></i>
                                            <span>Paramètres Système</span>
                                        </a>
                                        <% } %>

                                            <!-- Rapports & Historique -->
                                            <% if (['admin', 'technicien' ].includes(locals.userRole)) { %>
                                                <div class="sidebar-section-title">
                                                    <i class="bi bi-file-earmark-bar-graph me-1"></i>
                                                    RAPPORTS & HISTORIQUE
                                                </div>
                                                <a href="/admin/historique"
                                                    class="sidebar-menu-item <%= currentPath === '/admin/historique' ? 'active' : '' %>"
                                                    title="Historique des données">
                                                    <i class="bi bi-clock-history"></i>
                                                    <span>Historique des Données</span>
                                                </a>
                                                <% } %>
        </nav>
    </aside>

    <script>
        // Toggle sidebar sur mobile
        document.addEventListener('DOMContentLoaded', function () {
            const sidebar = document.getElementById('adminSidebar');
            const toggleBtn = document.getElementById('sidebarToggle');
            const content = document.querySelector('.admin-content');

            if (toggleBtn) {
                toggleBtn.addEventListener('click', function () {
                    sidebar.classList.toggle('show');
                });
            }

            // Fermer la sidebar en cliquant en dehors sur mobile
            document.addEventListener('click', function (event) {
                if (window.innerWidth <= 992) {
                    if (!sidebar.contains(event.target) && !toggleBtn.contains(event.target)) {
                        sidebar.classList.remove('show');
                    }
                }
            });

            // Fermer la sidebar après clic sur un lien (mobile)
            const menuItems = sidebar.querySelectorAll('.sidebar-menu-item');
            menuItems.forEach(item => {
                item.addEventListener('click', function () {
                    if (window.innerWidth <= 992) {
                        sidebar.classList.remove('show');
                    }
                });
            });
        });
    </script>